#/bin/bash

#
# $ Technique Folder
# $ Input
# $ Adapter extras
# $ model
# $ total Bubbles
# $ configFileParameters


UPX=/home/menendez/projects/upx/upx-3.91-srcBubbles/upx.sh
RUNPACKER=/home/menendez/projects/AntiEnt/Evasion/runPacker.sh
NAME=$(basename $2)
MD5EXPR=$(echo $6 | md5sum | cut -f1 -d' ')

sh $RUNPACKER $5 $6 > config.$MD5EXPR.ini
sh $UPX $2 $NAME.out config.$MD5EXPR.ini >/dev/null
if cmp -s $NAME.out $2
then
	echo "0"
else
	sh $1/adapter.sh $NAME.out $3 > /dev/null
	A=$($1/tester.r $4 $NAME.out.input 0)
	echo $A | rev| cut -f1 -d' ' | rev
fi


#B=$(sh fitness.sh /home/menendez/projects/AntiEnt/EnTS m.ts.u.VirusShare_efe55d4e3f3f1c1b7bb1150faef8e1e0.bin /home/menendez/config.ini /home/menendez/coevoData/EnTS/Test.model 10 10,0.451290159230639,0.386227392623756,0.453997148296771,0.444334639872252,13,0.381970865593314,0.433144922648058,0.654083329323571,0.612996921546048,12,0.616680352987051,0.595573049379593,0.629943464516813,0.428681964154763,10,0.359489539883067,0.565602559581662,0.499423440774708,0.557236661783036,8,0.511130943002762,0.522315823127171,0.465053173061881,0.472353765011029,11,0.476107175298393,0.501621307567335,0.545335580427434,0.53894082330864,10,0.499349341675027,0.31373750776244,0.512487267574428,0.451666952532772,10,0.420452532018038,0.435735728165253,0.387178432776668,0.557768492609705,11,0.597122744437463,0.552418446005205,0.611694820538477,0.455977712880752,10,0.508033033540745,0.522355622981439,0.5170653624527,0.626477505957048)
